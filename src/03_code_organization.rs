// ===== 3.1 å‡½æ•°/æ–¹æ³• =====

// å®šä¹‰å‡½æ•°ï¼šå°†è®¡ç®—é¢ç§¯çš„åŠŸèƒ½æ‰“åŒ…
fn calculate_area(length: f64, width: f64) -> f64 {  // å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹
    let area = length * width;                       // è®¡ç®—é€»è¾‘
    area                                             // Rust å‡½æ•°é»˜è®¤è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼
    // æˆ–è€…æ˜¾å¼ä½¿ç”¨ returnï¼š
    // return area;
}

// æ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°ï¼ˆè¿”å›å•å…ƒç±»å‹ ()ï¼‰
fn print_greeting(name: &str) {                      // &str æ˜¯å­—ç¬¦ä¸²å¼•ç”¨
    println!("ä½ å¥½ï¼Œ{}ï¼æ¬¢è¿æ¥åˆ° Rust ä¸–ç•Œï¼", name);
}

// å¸¦æœ‰å¤šä¸ªè¿”å›å€¼çš„å‡½æ•°ï¼ˆä½¿ç”¨å…ƒç»„ï¼‰
fn calculate_rectangle(length: f64, width: f64) -> (f64, f64) {
    let area = length * width;
    let perimeter = 2.0 * (length + width);
    (area, perimeter)                                // è¿”å›å…ƒç»„
}

// å‡½æ•°å‚æ•°çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨
fn take_ownership(s: String) {                       // è·å– String çš„æ‰€æœ‰æƒ
    println!("æ‹¥æœ‰äº†å­—ç¬¦ä¸²: {}", s);
}                                                    // s åœ¨è¿™é‡Œç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

fn borrow_string(s: &String) {                       // å€Ÿç”¨ String
    println!("å€Ÿç”¨äº†å­—ç¬¦ä¸²: {}", s);
}                                                    // s çš„æ‰€æœ‰æƒä»åœ¨è°ƒç”¨è€…

fn main() {
    // è°ƒç”¨å‡½æ•°ï¼šä½¿ç”¨å·²å®šä¹‰çš„åŠŸèƒ½
    let room_length = 5.0;
    let room_width = 4.0;
    let room_area = calculate_area(room_length, room_width);
    println!("æˆ¿é—´é¢ç§¯: {} å¹³æ–¹ç±³", room_area);
    
    // å†æ¬¡è°ƒç”¨ï¼šå‡½æ•°å¯ä»¥é‡å¤ä½¿ç”¨
    let garden_area = calculate_area(10.0, 8.0);
    println!("èŠ±å›­é¢ç§¯: {} å¹³æ–¹ç±³", garden_area);
    
    // è°ƒç”¨æ— è¿”å›å€¼çš„å‡½æ•°
    print_greeting("å°æ˜");
    
    // è°ƒç”¨è¿”å›å¤šä¸ªå€¼çš„å‡½æ•°
    let (area, perimeter) = calculate_rectangle(6.0, 4.0);
    println!("çŸ©å½¢é¢ç§¯: {}, å‘¨é•¿: {}", area, perimeter);
    
    // æ¼”ç¤ºæ‰€æœ‰æƒ
    let my_string = String::from("Hello, Rust!");
    borrow_string(&my_string);                       // å€Ÿç”¨ï¼Œä¸è½¬ç§»æ‰€æœ‰æƒ
    println!("è¿˜èƒ½ä½¿ç”¨: {}", my_string);            // ä»ç„¶å¯ä»¥ä½¿ç”¨
    
    take_ownership(my_string);                       // è½¬ç§»æ‰€æœ‰æƒ
    // println!("{}", my_string);                    // é”™è¯¯ï¼my_string çš„æ‰€æœ‰æƒå·²è½¬ç§»
    
    /* è¯´æ˜ï¼š
       - å‡½æ•°ä½¿ç”¨ fn å…³é”®å­—å®šä¹‰ï¼Œå‚æ•°å’Œè¿”å›å€¼éƒ½éœ€è¦æŒ‡å®šç±»å‹
       - å‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä¼šä½œä¸ºè¿”å›å€¼ï¼ˆä¸åŠ åˆ†å·ï¼‰
       - ä½¿ç”¨ return å¯ä»¥æå‰è¿”å›
       - () æ˜¯å•å…ƒç±»å‹ï¼Œè¡¨ç¤ºæ²¡æœ‰è¿”å›å€¼
       - å‡½æ•°å‚æ•°å¯ä»¥è·å–æ‰€æœ‰æƒæˆ–å€Ÿç”¨ï¼Œè¿™æ˜¯ Rust å†…å­˜å®‰å…¨çš„å…³é”®
    */
    
    println!();
    
    // ===== 3.2 ç»“æ„ä½“ =====
    
    // å®šä¹‰ç»“æ„ä½“ï¼šåˆ›å»ºè‡ªå®šä¹‰æ•°æ®ç±»å‹
    struct Cat {
        name: String,                                // å­—æ®µï¼šçŒ«çš„åå­—
        age: u8,                                     // å­—æ®µï¼šçŒ«çš„å¹´é¾„
        is_sleeping: bool,                           // å­—æ®µï¼šæ˜¯å¦åœ¨ç¡è§‰
    }
    
    // ä¸ºç»“æ„ä½“å®ç°æ–¹æ³•
    impl Cat {
        // å…³è”å‡½æ•°ï¼ˆç±»ä¼¼å…¶ä»–è¯­è¨€çš„é™æ€æ–¹æ³•ï¼‰
        fn new(name: String, age: u8) -> Cat {
            Cat {
                name,                                // å­—æ®µåå’Œå˜é‡åç›¸åŒæ—¶å¯ä»¥ç®€å†™
                age,
                is_sleeping: false,
            }
        }
        
        // æ–¹æ³•ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ &self
        fn meow(&self) {                            // ä¸å¯å˜å€Ÿç”¨ self
            if self.is_sleeping {
                println!("{}æ­£åœ¨ç¡è§‰ï¼Œä¸èƒ½å–µå–µå«...", self.name);
            } else {
                println!("{} è¯´: å–µå–µå–µ~", self.name);
            }
        }
        
        // å¯å˜æ–¹æ³•ï¼šéœ€è¦ä¿®æ”¹è‡ªèº«
        fn sleep(&mut self) {                        // å¯å˜å€Ÿç”¨ self
            self.is_sleeping = true;
            println!("{} å¼€å§‹ç¡è§‰äº† ğŸ’¤", self.name);
        }
        
        fn wake_up(&mut self) {
            self.is_sleeping = false;
            println!("{} é†’æ¥äº†ï¼", self.name);
        }
        
        // å¦ä¸€ä¸ªæ–¹æ³•
        fn introduce(&self) {
            println!("å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯{}ï¼Œä»Šå¹´{}å²äº†", self.name, self.age);
        }
    }
    
    // å…ƒç»„ç»“æ„ä½“ï¼ˆæ²¡æœ‰å­—æ®µåï¼‰
    struct Point(f64, f64);                          // å®šä¹‰ä¸€ä¸ªç‚¹
    
    // å•å…ƒç»“æ„ä½“ï¼ˆæ²¡æœ‰å­—æ®µï¼‰
    struct Marker;                                   // é€šå¸¸ç”¨ä½œæ ‡è®°
    
    // ä½¿ç”¨ç»“æ„ä½“
    println!("=== ç»“æ„ä½“ç¤ºä¾‹ ===");
    
    // åˆ›å»ºç»“æ„ä½“å®ä¾‹
    let mut my_cat = Cat::new(String::from("å°å’ª"), 3);
    let your_cat = Cat {
        name: String::from("èƒ–æ©˜"),
        age: 5,
        is_sleeping: true,
    };
    
    // è®¿é—®å­—æ®µ
    println!("æˆ‘çš„çŒ«å«: {}", my_cat.name);
    
    // è°ƒç”¨æ–¹æ³•
    my_cat.introduce();
    my_cat.meow();
    my_cat.sleep();
    my_cat.meow();                                   // ç¡ç€äº†å°±ä¸ä¼šå–µå–µå«
    my_cat.wake_up();
    my_cat.meow();                                   // é†’æ¥ååˆèƒ½å«äº†
    
    println!("\nä½ çš„çŒ«å«: {}", your_cat.name);
    your_cat.introduce();
    
    // ä½¿ç”¨å…ƒç»„ç»“æ„ä½“
    let origin = Point(0.0, 0.0);
    println!("\nåŸç‚¹åæ ‡: ({}, {})", origin.0, origin.1);
    
    /* è¯´æ˜ï¼š
       - struct å®šä¹‰ç»“æ„ä½“ï¼Œå°†ç›¸å…³æ•°æ®ç»„åˆåœ¨ä¸€èµ·
       - impl å—ä¸ºç»“æ„ä½“å®ç°æ–¹æ³•å’Œå…³è”å‡½æ•°
       - æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼ˆ&self å€Ÿç”¨ï¼Œ&mut self å¯å˜å€Ÿç”¨ï¼‰
       - å…³è”å‡½æ•°ï¼ˆå¦‚ newï¼‰é€šè¿‡ :: è°ƒç”¨ï¼Œæ–¹æ³•é€šè¿‡ . è°ƒç”¨
       - Rust æœ‰ä¸‰ç§ç»“æ„ä½“ï¼šå¸¸è§„ç»“æ„ä½“ã€å…ƒç»„ç»“æ„ä½“ã€å•å…ƒç»“æ„ä½“
    */
    
    println!();
    
    // ===== 3.3 å…¶ä»–å…³é”®æœºåˆ¶ =====
    
    // 1. é”™è¯¯å¤„ç†ï¼šResult å’Œ Option
    println!("=== é”™è¯¯å¤„ç†ç¤ºä¾‹ ===");
    
    // ä½¿ç”¨ Result å¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œ
    fn divide(a: f64, b: f64) -> Result<f64, String> {
        if b == 0.0 {
            Err(String::from("é™¤æ•°ä¸èƒ½ä¸º0ï¼"))      // è¿”å›é”™è¯¯
        } else {
            Ok(a / b)                                // è¿”å›æˆåŠŸç»“æœ
        }
    }
    
    // ä½¿ç”¨ match å¤„ç† Result
    let result1 = divide(10.0, 2.0);
    match result1 {
        Ok(value) => println!("10 Ã· 2 = {}", value),
        Err(e) => println!("è®¡ç®—å‡ºé”™: {}", e),
    }
    
    // ä½¿ç”¨ ? æ“ä½œç¬¦ç®€åŒ–é”™è¯¯å¤„ç†
    fn calculate() -> Result<(), String> {
        let result = divide(10.0, 0.0)?;             // ? ä¼šæå‰è¿”å›é”™è¯¯
        println!("ç»“æœ: {}", result);
        Ok(())
    }
    
    // å¤„ç†é”™è¯¯
    if let Err(e) = calculate() {
        println!("å‡ºé”™äº†: {}", e);
    }
    
    // Option ç±»å‹ï¼šè¡¨ç¤ºå€¼å¯èƒ½å­˜åœ¨æˆ–ä¸å­˜åœ¨
    let numbers = vec![1, 2, 3];
    let first = numbers.get(0);                      // è¿”å› Option<&i32>
    let tenth = numbers.get(10);                     // è¿”å› None
    
    println!("\nç¬¬ä¸€ä¸ªå…ƒç´ : {:?}", first);
    println!("ç¬¬åä¸ªå…ƒç´ : {:?}", tenth);
    
    // ä½¿ç”¨ unwrap_or æä¾›é»˜è®¤å€¼
    let value = tenth.unwrap_or(&0);
    println!("è·å–ç¬¬åä¸ªå…ƒç´ æˆ–é»˜è®¤å€¼: {}", value);
    
    /* è¯´æ˜ï¼š
       - Result<T, E> ç”¨äºå¯èƒ½å¤±è´¥çš„æ“ä½œï¼ŒOk(T) è¡¨ç¤ºæˆåŠŸï¼ŒErr(E) è¡¨ç¤ºå¤±è´¥
       - Option<T> ç”¨äºå€¼å¯èƒ½ä¸å­˜åœ¨çš„æƒ…å†µï¼ŒSome(T) è¡¨ç¤ºæœ‰å€¼ï¼ŒNone è¡¨ç¤ºæ— å€¼
       - ? æ“ä½œç¬¦å¯ä»¥ç®€åŒ–é”™è¯¯ä¼ æ’­
       - è¿™ç§æ˜¾å¼çš„é”™è¯¯å¤„ç†è®© Rust ç¨‹åºæ›´åŠ å¥å£®
    */
    
    println!();
    
    // 2. æ³¨é‡Šï¼šè®©ä»£ç æ›´æ˜“ç†è§£
    println!("=== æ³¨é‡Šç¤ºä¾‹ ===");
    
    // è¿™æ˜¯å•è¡Œæ³¨é‡Šï¼šè§£é‡Šä¸‹ä¸€è¡Œä»£ç çš„ä½œç”¨
    let pi = 3.14159;                               // ä¹Ÿå¯ä»¥æ”¾åœ¨ä»£ç åé¢
    
    /*
       è¿™æ˜¯å¤šè¡Œæ³¨é‡Šï¼š
       å¯ä»¥å†™æ›´è¯¦ç»†çš„è¯´æ˜
       æ¯”å¦‚è§£é‡Šä¸€ä¸ªå¤æ‚çš„ç®—æ³•
       æˆ–è€…è®°å½•é‡è¦çš„è®¾è®¡å†³ç­–
    */
    
    /// æ–‡æ¡£æ³¨é‡Šï¼ˆç”¨äºç”Ÿæˆæ–‡æ¡£ï¼‰ï¼š
    /// è®¡ç®—åœ†çš„å‘¨é•¿
    /// 
    /// # å‚æ•°
    /// 
    /// * `radius` - åœ†çš„åŠå¾„
    /// 
    /// # è¿”å›å€¼
    /// 
    /// è¿”å›åœ†çš„å‘¨é•¿
    /// 
    /// # ç¤ºä¾‹
    /// 
    /// ```
    /// let circumference = calculate_circumference(5.0);
    /// assert_eq!(circumference, 31.4159);
    /// ```
    fn calculate_circumference(radius: f64) -> f64 {
        // TODO: å¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´ç²¾ç¡®çš„ PI å¸¸é‡
        2.0 * pi * radius
    }
    
    //! è¿™æ˜¯æ¨¡å—çº§æ–‡æ¡£æ³¨é‡Š
    //! é€šå¸¸æ”¾åœ¨æ–‡ä»¶å¼€å¤´ï¼Œæè¿°æ•´ä¸ªæ¨¡å—çš„åŠŸèƒ½
    
    println!("åœ†çš„å‘¨é•¿ï¼ˆåŠå¾„=5ï¼‰: {:.4}", calculate_circumference(5.0));
    
    /* è¯´æ˜ï¼š
       - // å•è¡Œæ³¨é‡Šï¼šç”¨äºç®€çŸ­çš„è¯´æ˜
       - /* */ å¤šè¡Œæ³¨é‡Šï¼šç”¨äºè¾ƒé•¿çš„è§£é‡Š
       - /// æ–‡æ¡£æ³¨é‡Šï¼šç”Ÿæˆ API æ–‡æ¡£ï¼Œæ”¯æŒ Markdown
       - //! æ¨¡å—æ–‡æ¡£æ³¨é‡Šï¼šæè¿°æ•´ä¸ªæ¨¡å—æˆ– crate
       - å¥½çš„æ³¨é‡Šè§£é‡Š"ä¸ºä»€ä¹ˆ"ï¼Œè€Œä¸ä»…ä»…æ˜¯"åšä»€ä¹ˆ"
       - Rust é¼“åŠ±ç¼–å†™è‡ªè§£é‡Šçš„ä»£ç ï¼Œå‡å°‘ä¸å¿…è¦çš„æ³¨é‡Š
    */
}